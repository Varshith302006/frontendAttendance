<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Attendance Dashboard</title>
<link rel="icon" type="image/svg+xml" href="favicon.svg" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  
<style>
:root {
  /* Modern Color Palette */
  --primary: #6366f1;
  --primary-hover: #4f46e5;
  --primary-light: #eef2ff;
  --secondary: #8b5cf6;
  --success: #10b981;
  --success-light: #d1fae5;
  --danger: #ef4444;
  --danger-light: #fee2e2;
  --warning: #f59e0b;
  --warning-light: #fef3c7;
  --info: #06b6d4;
  
  /* Neutrals - Light Mode */
  --bg-primary: #f8fafc;
  --bg-secondary: #ffffff;
  --text-primary: #0f172a;
  --text-secondary: #64748b;
  --text-muted: #94a3b8;
  --border: #e2e8f0;
  --border-light: #f1f5f9;
  --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
  --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
  --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
  
  /* Gradient */
  --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  --gradient-success: linear-gradient(135deg, #10b981 0%, #059669 100%);
  --gradient-danger: linear-gradient(135deg, #f87171 0%, #ef4444 100%);
  
  /* Spacing */
  --radius: 12px;
  --radius-lg: 16px;
  --radius-full: 9999px;
}

/* Dark Mode */
body[data-theme="dark"] {
  /* Dark Mode Colors */
  --primary-light: #312e81;
  --success-light: #064e3b;
  --danger-light: #7f1d1d;
  --warning-light: #78350f;
  
  /* Neutrals - Dark Mode */
  --bg-primary: #0f172a;
  --bg-secondary: #1e293b;
  --text-primary: #f1f5f9;
  --text-secondary: #cbd5e1;
  --text-muted: #94a3b8;
  --border: #334155;
  --border-light: #293548;
  --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
  --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.4), 0 2px 4px -1px rgba(0, 0, 0, 0.3);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.5), 0 4px 6px -2px rgba(0, 0, 0, 0.4);
  --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.6), 0 10px 10px -5px rgba(0, 0, 0, 0.5);
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: var(--bg-primary);
  color: var(--text-primary);
  line-height: 1.6;
  min-height: 100vh;
}

/* Header */
header {
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--border);
  padding: 16px 0;
  position: sticky;
  top: 0;
  z-index: 100;
  backdrop-filter: blur(10px);
  box-shadow: var(--shadow-sm);
}

.header-container {
  max-width: 1280px;
  margin: 0 auto;
  padding: 0 24px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.header-title {
  display: flex;
  align-items: center;
  gap: 12px;
}

.logo {
  width: 40px;
  height: 40px;
  background: var(--gradient-primary);
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: 700;
  font-size: 18px;
}

header h2 {
  font-size: 20px;
  font-weight: 600;
  color: var(--text-primary);
}

.header-actions {
  display: flex;
  align-items: center;
  gap: 16px;
}
#themeToggle {
  width: 52px;
  height: 28px;
  border: none;
  background: #cbd5e1;
  border-radius: 14px;
  cursor: pointer;
  display: flex !important;
  align-items: center;
  padding: 2px;
  transition: background 0.3s ease;
  position: relative;
  flex-shrink: 0;
}
#themeToggle:hover {
  background: #94a3b8;
}

body[data-theme="dark"] #themeToggle {
  background: var(--primary);
}

body[data-theme="dark"] #themeToggle:hover {
  background: var(--primary-hover);
}
#themeIcon {
  width: 24px;
  height: 24px;
  background: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 11px;
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  position: absolute;
  left: 2px;
}

body[data-theme="dark"] #themeIcon {
  transform: translateX(24px);
}

#visitsBadge {
  background: var(--primary-light);
  color: var(--primary);
  padding: 8px 16px;
  border-radius: var(--radius-full);
  font-weight: 600;
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 8px;
}

#logoutBtn {
  padding: 10px 20px;
  border: none;
  border-radius: var(--radius);
  background: var(--danger);
  color: white;
  cursor: pointer;
  font-weight: 600;
  font-size: 14px;
  transition: all 0.2s;
  display: none;
}

#logoutBtn:hover {
  background: #dc2626;
  transform: translateY(-1px);
  box-shadow: var(--shadow);
}

/* Container */
.container {
  max-width: 1280px;
  margin: 0 auto;
  padding: 32px 24px;
}

/* Login Card */
.login-card {
  background: var(--bg-secondary);
  padding: 48px;
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-xl);
  max-width: 480px;
  margin: 80px auto;
  border: 1px solid var(--border);
}

.login-header {
  text-align: center;
  margin-bottom: 32px;
}

.login-icon {
  width: 64px;
  height: 64px;
  background: var(--gradient-primary);
  border-radius: var(--radius-lg);
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 16px;
  color: white;
  font-size: 32px;
}

.login-header h3 {
  font-size: 24px;
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: 8px;
}

.login-header p {
  color: var(--text-secondary);
  font-size: 14px;
}

/* Form */
form {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.field {
  position: relative;
}

.field label {
  display: block;
  font-size: 14px;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 8px;
}

.field input {
  width: 100%;
  height: 48px;
  padding: 0 16px;
  border: 2px solid var(--border);
  border-radius: var(--radius);
  font-size: 15px;
  transition: all 0.2s;
  background: var(--bg-primary);
  color: var(--text-primary);
}

.field input:focus {
  border-color: var(--primary);
  outline: none;
  background: var(--bg-secondary);
  box-shadow: 0 0 0 3px var(--primary-light);
  color: var(--text-primary);
}

.password-field input {
  padding-right: 48px;
}

.toggle-icon {
  position: absolute;
  right: 12px;
  top: 38px;
  cursor: pointer;
  color: var(--text-muted);
  transition: color 0.2s;
}

.toggle-icon:hover {
  color: var(--text-primary);
}

/* Button */
.btn {
  height: 48px;
  padding: 0 24px;
  background: var(--gradient-primary);
  border: none;
  color: white;
  font-weight: 600;
  font-size: 15px;
  cursor: pointer;
  border-radius: var(--radius);
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.btn:active {
  transform: translateY(0);
}

#formLoader {
  display: none;
  text-align: center;
  margin-top: 16px;
}

.loader {
  border: 3px solid var(--border);
  border-top: 3px solid var(--primary);
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;
  margin: 0 auto 12px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

#formLoader p {
  color: var(--text-secondary);
  font-size: 14px;
}

/* Dashboard Grid */
.dashboard-grid {
  display: none;
  gap: 24px;
  margin-top: 32px;
  opacity: 0;
  transition: opacity 0.3s;
}

.dashboard-grid.show {
  opacity: 1;
}

/* Stats Cards */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 20px;
  margin-bottom: 24px;
}

.stat-card {
  background: var(--bg-secondary);
  padding: 24px;
  border-radius: var(--radius-lg);
  border: 1px solid var(--border);
  box-shadow: var(--shadow-sm);
  transition: all 0.2s;
}

.stat-card:hover {
  transform: translateY(-4px);
  box-shadow: var(--shadow-lg);
}

.stat-card-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 12px;
}

.stat-card-title {
  font-size: 14px;
  font-weight: 500;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.stat-card-icon {
  width: 48px;
  height: 48px;
  border-radius: var(--radius);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
}

.stat-card-value {
  font-size: 36px;
  font-weight: 700;
  color: var(--text-primary);
  line-height: 1;
  margin-bottom: 8px;
}

.stat-card-label {
  font-size: 13px;
  color: var(--text-muted);
}

/* Card */
.card {
  background: var(--bg-secondary);
  border-radius: var(--radius-lg);
  border: 1px solid var(--border);
  box-shadow: var(--shadow);
  overflow: hidden;
}

.card-header {
  padding: 24px;
  border-bottom: 1px solid var(--border);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.card-header h3 {
  font-size: 18px;
  font-weight: 600;
  color: var(--text-primary);
  display: flex;
  align-items: center;
  gap: 10px;
}

.card-body {
  padding: 24px;
}

/* Table */
.table-wrapper {
  overflow-x: auto;
}

table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}

thead {
  background: var(--bg-primary);
}

th {
  padding: 12px 16px;
  text-align: left;
  font-weight: 600;
  color: var(--text-secondary);
  text-transform: uppercase;
  font-size: 12px;
  letter-spacing: 0.5px;
  border-bottom: 2px solid var(--border);
}

td {
  padding: 16px;
  border-bottom: 1px solid var(--border-light);
  color: var(--text-primary);
}

tr:last-child td {
  border-bottom: none;
}

tr:hover {
  background: var(--bg-primary);
}

/* Progress Bar */
.progress {
  background: var(--border-light);
  height: 24px;
  border-radius: var(--radius-full);
  overflow: hidden;
  position: relative;
  box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.06);
}

.progress-bar {
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 12px;
  font-weight: 600;
  transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
}

.progress-bar::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
  animation: shimmer 2s infinite;
}

@keyframes shimmer {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

/* Badge */
.badge {
  display: inline-flex;
  align-items: center;
  padding: 4px 12px;
  border-radius: var(--radius-full);
  font-size: 12px;
  font-weight: 600;
}

.badge-success {
  background: var(--success-light);
  color: var(--success);
}

.badge-danger {
  background: var(--danger-light);
  color: var(--danger);
}

/* Simulation Card */
#todayClassesCard {
  display: none;
  margin-top: 24px;
}

.simulation-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
}

.simulation-controls {
  display: flex;
  gap: 12px;
}

#resetTodayBtn {
  width: 40px;
  height: 40px;
  border: 2px solid var(--border);
  background: var(--bg-secondary);
  border-radius: var(--radius);
  cursor: pointer;
  font-size: 20px;
  color: var(--text-secondary);
  transition: all 0.2s;
  display: none;
}

#resetTodayBtn:hover {
  background: var(--bg-primary);
  color: var(--text-primary);
  border-color: var(--primary);
}

.today-row {
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 12px;
  margin-bottom: 16px;
  align-items: center;
}

.today-row select {
  height: 48px;
  padding: 0 16px;
  border: 2px solid var(--border);
  border-radius: var(--radius);
  font-size: 14px;
  background: var(--bg-primary);
  color: var(--text-primary);
  cursor: pointer;
  transition: all 0.2s;
}

.today-row select:hover {
  border-color: var(--primary);
}

.today-row select:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px var(--primary-light);
  background: var(--bg-secondary);
}

.btn-container {
  display: flex;
  gap: 12px;
}

.today-row .btn {
  height: 48px;
  min-width: 120px;
}

.attend-btn {
  background: linear-gradient(135deg, #76d47b, #76ef7c);
}

.attend-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  background: #01ff5e;
}

.attend-btn.active {
  background: #45a049 !important;
}

.bunk-btn {
  background: linear-gradient(135deg, #f87f7d, #f67b7b);
}

.bunk-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(252, 2, 2, 0.15);
  background: #fc0101;
}

.bunk-btn.active {
  background: #e63a3a !important;
}

#newOverallAttendance {
  margin-top: 24px;
  padding: 20px;
  background: var(--primary-light);
  border-left: 4px solid var(--primary);
  border-radius: var(--radius);
  text-align: center;
  font-size: 16px;
  font-weight: 600;
  color: var(--primary);
}

/* Grid Layout */
.grid-2 {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 24px;
}

/* Responsive */
@media (max-width: 768px) {
  .container {
    padding: 20px 16px;
  }

  .login-card {
    padding: 32px 24px;
    margin: 40px 16px;
  }

  .header-container {
    padding: 0 16px;
  }

  header h2 {
    font-size: 16px;
  }

  .grid-2 {
    grid-template-columns: 1fr;
  }

  .today-row {
    grid-template-columns: 1fr;
  }

  .btn-container {
    width: 100%;
  }

  .today-row .btn {
    flex: 1;
  }

  .stats-grid {
    grid-template-columns: 1fr;
  }

  table {
    font-size: 12px;
  }

  th, td {
    padding: 8px;
  }
}
@media (max-width: 768px) {
  .table-wrapper {
    position: relative;
  }
  .table-wrapper::after {
    content: '';
    pointer-events: none;
    display: block;
    position: absolute;
    right: 0; top: 0; bottom: 0;
    width: 32px;
    background: linear-gradient(to left, var(--bg-primary), transparent 75%);
    z-index: 2;
    opacity: 1;
    transition: opacity 0.4s;
  }
  .table-wrapper.scrolled-end::after {
    opacity: 0;
  }
  .table-scroll-hint {
    color: var(--text-muted);
    font-size: 13px;
    margin-bottom: 4px;
    text-align: right;
    padding-right: 8px;
    display: block;
  }
}

@media (max-width: 480px) {
  .login-card {
    padding: 24px 20px;
  }

  .stat-card-value {
    font-size: 28px;
  }

  .card-header, .card-body {
    padding: 16px;
  }
  /* Academic Attendance Table - 3D Horizontal Scroll Effect */
.table-wrapper {
  box-shadow: 0 4px 24px rgba(0,0,0,0.08), 0 1.5px 4px rgba(40,37,86,0.10);
  border-radius: 18px;
  background: var(--bg-secondary);
  padding: 8px 0;
  perspective: 800px;
}
.table-wrapper table {
  background: transparent;
  border-radius: 18px;
  overflow: hidden;
  transition: transform 0.25s cubic-bezier(0.4,0,0.2,1);
  box-shadow: 0 1px 10px rgba(25,40,60,0.06);
}
}

/* Loading State */
.loading-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 48px;
  color: var(--text-secondary);
}

.loading-state .loader {
  margin-bottom: 16px;
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 48px 24px;
  color: var(--text-secondary);
}

.empty-state-icon {
  font-size: 48px;
  margin-bottom: 16px;
  opacity: 0.5;
}

.table-wrapper table {
  border-collapse: separate;
  border-spacing: 0;
}

.table-wrapper th, .table-wrapper td {
  border-bottom: 1px solid var(--border-light);
}
.table-wrapper tr:last-child td {
  border-bottom: none;
}

.table-wrapper th {
  border-top-left-radius: 12px;
  border-top-right-radius: 12px;
  background: var(--bg-primary);
  text-align: center;
  font-size: 13px;
  letter-spacing: 0.04em;
}
.card-body .table-wrapper {
  margin: 0 4px 6px 4px;
  padding: 0 2px;
}
/* .card, .table-wrapper {
  background: #fff;
} */
body[data-theme="dark"] .table-wrapper {
  box-shadow: 0 4px 24px rgba(0,0,0,0.18), 0 1.5px 4px rgba(10,18,40,0.22);
  background: var(--bg-secondary);
}
body[data-theme="dark"] .table-wrapper table {
  background: var(--bg-primary);
}
body[data-theme="dark"] .table-wrapper::after {
  background: linear-gradient(to left, var(--bg-secondary), rgba(30,41,59,0) 75%);
  opacity: 0.7;
}
body[data-theme="dark"] .table-wrapper th {
  background: var(--bg-primary);
  color: var(--text-secondary);
}
/* Skeleton Loader */
.skeleton-container {
  margin-top: 40px;
  display: grid;
  gap: 20px;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
}

.skeleton-card {
  height: 140px;
  border-radius: 14px;
  background: linear-gradient(90deg, var(--border-light) 25%, var(--border) 50%, var(--border-light) 75%);
  background-size: 200% 100%;
  animation: skeleton-loading 1.4s infinite;
}

.skeleton-card.wide {
  height: 300px;
  grid-column: span 2;
}

@keyframes skeleton-loading {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

</style>
</head>
<body>
<div style="position: fixed; bottom: 10px; right: 10px; z-index: 999; font-size: 12px; color: #999;">
    UMA CREATIONS
</div>


<header>
  <div class="header-container">
    <div class="header-title">
      <div class="logo">üìä</div>
      <h2>My Attendance Dashboard</h2>
    </div>
    <div class="header-actions">
      <button id="themeToggle" title="Toggle dark mode" style="display: flex !important;">
        <span id="themeIcon">üåô</span>
      </button>
      <div id="visitsBadge">
        <span>üë•</span>
        <span id="visitsCount">0</span>
      </div>
      <button id="logoutBtn">Logout</button>
    </div>
  </div>
</header>

<div class="container">
  <!-- Login Card -->
  <div class="login-card" id="loginCard">
    <div class="login-header">
      <div class="login-icon">üéì</div>
      <h3>Student Login</h3>
      <p>Enter your credentials to view your attendance</p>
    </div>

    <form id="loginForm" autocomplete="on">
      <div class="field">
        <label for="username">Student ID</label>
        <input type="text" name="username" id="username" placeholder="Enter your student ID" required>
      </div>
      <div class="field password-field">
        <label for="passwordField">Password</label>
        <input type="password" name="password" id="passwordField" placeholder="Enter your password" required>
        <span id="togglePassword" class="toggle-icon">
          <svg id="eyeOpen" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
            <path d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
          </svg>
          <svg id="eyeClosed" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" style="display:none;">
            <path d="M3 3l18 18"/>
            <path d="M10.584 10.587a2 2 0 002.828 2.826"/>
            <path d="M9.363 5.365A9.466 9.466 0 0112 5c4.478 0 8.268 2.943 9.542 7a9.963 9.963 0 01-1.363 2.419m-2.756 2.755A9.464 9.464 0 0112 19c-4.478 0-8.268-2.943-9.542-7a9.963 9.963 0 013.13-4.49"/>
          </svg>
        </span>
      </div>
      <button type="submit" class="btn" id="loginBtn">
        <span>Sign In</span>
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M5 12h14M12 5l7 7-7 7"/>
        </svg>
      </button>
      <div id="formLoader">
        <div class="loader"></div>
        <p>Fetching your attendance data...<br>Please wait a moment</p>
      </div>
    </form>
    
  </div>
  <div id="skeletonLoader" class="skeleton-container" style="display:none;">
    <div class="skeleton-card"></div>
    <div class="skeleton-card"></div>
    <div class="skeleton-card wide"></div>
  </div>

   <!-- Dashboard -->
  <div class="dashboard-grid" id="dashboardCards">
    <!-- Stats Cards -->
    <div class="stats-grid" id="statsGrid"></div>
      <!-- Academic Attendance -->
    <div class="card" id="academicCard">
      <div class="card-header">
        <h3>
          <span>üìö</span>
          Academic Attendance
        </h3>
      </div>
      <div class="card-body">
        <div id="academicTable" class="empty-state">
          <div class="empty-state-icon">üìä</div>
          <p>Login to fetch attendance data</p>
        </div>
      </div>
    </div>

    <!-- Biometric Attendance -->
    <div class="card" id="biometricCard">
      <div class="card-header">
        <h3>
          <span>üîê</span>
          Biometric Attendance
        </h3>
      </div>
      <div class="card-body">
        <div id="biometricTable" class="empty-state">
          <div class="empty-state-icon">üë§</div>
          <p>Login to fetch attendance data</p>
        </div>
        <div id="biometricSection">
          <div class="btn-container">
            <button id="biometricAttendBtn" class="btn attend-btn">Attend</button>
            <button id="biometricBunkBtn" class="btn bunk-btn">Bunk</button>
          </div>
          <p id="attendanceMessage"></p>
        </div>
      </div>
    </div>
</div>
 
 

    <!-- Attendance Simulation -->
    <div class="card" id="todayClassesCard">
      <div class="card-header">
        <h3>
          <span>üéØ</span>
          Attendance Simulator
        </h3>
        <div class="simulation-controls">
          <button id="resetTodayBtn" title="Reset selections">‚Üª</button>
        </div>
      </div>
      <div class="card-body">
        <div id="todayClassesContainer"></div>
        <div id="newOverallAttendance"></div>
      </div>
    </div>
  </div>
</div>


<script>

const passwordField = document.getElementById('passwordField');
const togglePassword = document.getElementById('togglePassword');
const eyeOpen = document.getElementById('eyeOpen');
const eyeClosed = document.getElementById('eyeClosed');
const formLoader = document.getElementById('formLoader');
const logoutBtn = document.getElementById('logoutBtn');
const loginCard = document.getElementById('loginCard');
const dashboardCards = document.getElementById('dashboardCards');
const visitsBadge = document.getElementById('visitsBadge');
const visitsCount = document.getElementById('visitsCount');
const resetBtn = document.getElementById('resetTodayBtn');
const todayContainer = document.getElementById('todayClassesContainer');
const newOverallEl = document.getElementById('newOverallAttendance');
const themeToggle = document.getElementById('themeToggle');
const themeIcon = document.getElementById('themeIcon');

// Theme Management - Initialize on page load
function initTheme() {
  const currentTheme = localStorage.getItem('theme') || 
    (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');

  if (currentTheme === 'dark') {
    document.body.setAttribute('data-theme', 'dark');
    themeIcon.textContent = '‚òÄÔ∏è';
  } else {
    document.body.removeAttribute('data-theme');
    themeIcon.textContent = 'üåô';
  }
}

// Initialize theme immediately
initTheme();

themeToggle.addEventListener('click', () => {
  const theme = document.body.getAttribute('data-theme');
  if (theme === 'dark') {
    document.body.removeAttribute('data-theme');
    themeIcon.textContent = 'üåô';
    localStorage.setItem('theme', 'light');
  } else {
    document.body.setAttribute('data-theme', 'dark');
    themeIcon.textContent = '‚òÄÔ∏è';
    localStorage.setItem('theme', 'dark');
  }
});

togglePassword.addEventListener('click', () => {
  const type = passwordField.type === 'password' ? 'text' : 'password';
  passwordField.type = type;
  eyeOpen.style.display = type === 'password' ? 'block' : 'none';
  eyeClosed.style.display = type === 'password' ? 'none' : 'block';
});
window.addEventListener('DOMContentLoaded', () => {
  visitsBadge.style.display = 'flex'; 
  updateTodayVisits();
});

function showDashboard(studentId) {
  loginCard.style.display = 'none';
  dashboardCards.style.display = 'block';
  setTimeout(() => {
    dashboardCards.classList.add('show');
  }, 10);
  document.querySelector('header h2').textContent = `${studentId}'s Dashboard`;
  logoutBtn.style.display = 'block';
  logoutBtn.onclick = () => { location.reload(); };

  visitsBadge.style.display = 'flex';
  document.getElementById('todayClassesCard').style.display = 'block';
  resetBtn.style.display = 'block';
}
async function updateTodayVisits() {
  try {
    const res = await fetch('https://attendance-4rm8.onrender.com/today-logins');
    if (!res.ok) throw new Error('Failed to fetch today visits');
    const data = await res.json();
    visitsCount.textContent = data.today_logins || 0;
  } catch (err) {
    console.error('Error fetching today visits:', err);
    visitsCount.textContent = '?';
  }
}
// Caching System (10-minute expiration)
// Caching System (10-minute expiration, cleared on tab close)
const CACHE_DURATION = 2 * 60 * 1000; // 2 minutes

function setCache(key, data) {
  const record = { data, timestamp: Date.now() };
  sessionStorage.setItem(key, JSON.stringify(record));
}

function getCache(key) {
  const item = sessionStorage.getItem(key);
  if (!item) return null;

  try {
    const record = JSON.parse(item);
    if (Date.now() - record.timestamp < CACHE_DURATION) {
      return record.data;
    } else {
      sessionStorage.removeItem(key);
      return null;
    }
  } catch (e) {
    console.error("Cache parse error", e);
    return null;
  }
}


document.getElementById('loginForm').addEventListener('submit', async e => {
  e.preventDefault();
  const formData = new FormData(e.target);
  const username = formData.get('username');
  const password = formData.get('password');
  const cacheKey = `attendance_${username}`;

  // HIDE LOGIN CARD IMMEDIATELY
  loginCard.style.display = "none";
  // SHOW ONLY DASHBOARD SKELETON
  document.getElementById('skeletonLoader').style.display = 'grid';

  let data, isFresh = false;

  try {
    const res = await fetch('/api/get',{
      method: 'POST',
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, password })
    });

    if (res.ok) {
      data = await res.json();
      const fetchedAt = data.fetched_at ? new Date(data.fetched_at) : null;
      isFresh = fetchedAt && (Date.now() - fetchedAt.getTime() < 1 * 60 * 1000);
    }
  } catch (err) {}

  let shouldFetchFromBackend = !data || !isFresh;

  // CASE 1: Cached data fresh
  if (data && isFresh) {

    if (!Array.isArray(data.academic_data) || data.academic_data.length === 0) {
      document.getElementById('skeletonLoader').style.display = 'none';
      loginCard.style.display = "block";   // show login again
      dashboardCards.style.display = "none"; // hide dashboard (safety)
      alert("Check Username and Password");
      return;
    }

    document.getElementById('skeletonLoader').style.display = 'none';
    showDashboard(username);
    renderAcademic(data.academic_data, username);
    renderBiometric(data.biometric_data);
    renderLatestAttendance(latestAttendance);
    return;
  }

  // CASE 2: Backend fetch
  if (shouldFetchFromBackend) {
    try {
      const res = await fetch('https://attendance-4rm8.onrender.com/get-attendance', {
        method: 'POST',
        body: new URLSearchParams({ username, password })
      });

      if (!res.ok) throw new Error("Wrong credentials");

      const text = await res.text();
      const lines = text.split('\n');
      let academicData, biometricData, fetchedAt;

      lines.forEach(line => {
        if (!line.trim()) return;
        const obj = JSON.parse(line);
        if (obj.step === 'academic') academicData = obj.data;
        if (obj.step === 'biometric') biometricData = obj.data;
        if (obj.step === 'latest') latestAttendance = obj.data;  
        if (obj.step === 'fetched_at') fetchedAt = obj.data;
      });

      if (!academicData || academicData.length === 0) {
        document.getElementById('skeletonLoader').style.display = 'none';
        loginCard.style.display = "block";   // show login again
        dashboardCards.style.display = "none"; // hide dashboard (safety)
        alert("Check Username and Password");
        return;
      }

      // SUCCESS ‚Üí SHOW DASHBOARD
      document.getElementById('skeletonLoader').style.display = 'none';
      showDashboard(username);
      renderAcademic(academicData, username);
      renderBiometric(biometricData);
      renderLatestAttendance(latestAttendance);

    } catch (err) {
      document.getElementById('skeletonLoader').style.display = 'none';
      loginCard.style.display = "block";
      dashboardCards.style.display = "none";
      alert("Invalid credentials or network issue");
    }
  }
});



function renderAcademic(data,username) {
  if (!Array.isArray(data) || data.length === 0) {
    document.getElementById('academicTable').innerHTML = '<div class="empty-state"><div class="empty-state-icon">üì≠</div><p>No academic data available</p></div>';
    alert("Check Username and Password");
    return;
  }

  let total = 0;
  data.forEach(sub => total += Number(sub.percentage) || 0);
  const avg = (total / data.length).toFixed(2);
  let T = 0;
  let tot = 0;
  data.forEach(sub => T +=Number(sub.attended)||0 );
  data.forEach(sub => tot += Number(sub.total)|| 0 );
  const TT = (T*100/tot).toFixed(2);
  // Update stats cards
  const statsGrid = document.getElementById('statsGrid');
    let statsHtml = `
    <div class="stat-card">
        <div class="stat-card-header">
        <div>
            <div class="stat-card-title">Average Attendance</div>
            <div class="stat-card-value">${avg}%</div>
            <div class="stat-card-label">Academic Performance</div>
        </div>
        <div class="stat-card-icon" style="background: var(--primary-light); color: var(--primary);">üìä</div>
        </div>
    </div>
    `;

    statsHtml += `
        <div class="stat-card">
        <div class="stat-card-header">
            <div>
            <div class="stat-card-title">Total Attend/Total</div>
            <div class="stat-card-value">${TT}%</div>
            <div class="stat-card-label">Performance</div>
            </div>
            <div class="stat-card-icon" style="background: var(--success-light); color: var(--success);">üìö</div>
        </div>
        </div>
    `;

    // Continue appending the other cards
    // statsHtml += `
    // <div class="stat-card">
    //     <div class="stat-card-header">
    //     <div>
    //         <div class="stat-card-title">Total Subjects</div>
    //         <div class="stat-card-value">${data.length}</div>
    //         <div class="stat-card-label">Enrolled Courses</div>
    //     </div>
    //     <div class="stat-card-icon" style="background: var(--success-light); color: var(--success);">üìö</div>
    //     </div>
    // </div>
    // `;
  // if(username!="24951A05DF"&&username != "24951A05DX"){
  //   statsHtml +=  `
  //   <div class="stat-card">
  //       <div class="stat-card-header">
  //       <div>
  //           <div class="stat-card-title">Status</div>
  //           <div class="stat-card-value">${avg >= 75 ? '‚úì' : '‚ö†'}</div>
  //           <div class="stat-card-label">${avg >= 75 ? 'On Track' : 'Needs Attention'}</div>
  //       </div>
  //       <div class="stat-card-icon" style="background: ${avg >= 75 ? 'var(--success-light)' : 'var(--danger-light)'}; color: ${avg >= 75 ? 'var(--success)' : 'var(--danger)'};">${avg >= 75 ? '‚úì' : '!'}</div>
  //       </div>
  //   </div>
  //   `;
  //   }

    statsGrid.innerHTML = statsHtml;

  let html = '<div class="table-scroll-hint">‚¨ÖÔ∏è Scroll to see more ‚¨ÖÔ∏è</div><div class="table-wrapper"><table><thead><tr>';
  html += '<th>Course Code</th><th>Subject</th><th>Attended</th><th>Tot</th><th>Percentage</th><th>To 75%</th><th>Can Bunk</th><th>Progress</th>';
  html += '</tr></thead><tbody>';

  data.forEach(sub => {
    const pct = Number(sub.percentage) || 0;
    const bg = pct >= 75 ? 'var(--gradient-success)' : 'var(--gradient-danger)';
    html += `<tr>
      <td><strong>${escapeHtml(sub.courseCode)}</strong></td>
      <td>${escapeHtml(sub.subject)}</td>
      <td>${escapeHtml(sub.attended)}</td>
      <td>${escapeHtml(sub.total)}</td>
      <td><span class="badge ${pct >= 75 ? 'badge-success' : 'badge-danger'}">${pct.toFixed(2)}%</span></td>
      <td>${escapeHtml(sub.classesToAttendFor75)}</td>
      <td>${escapeHtml(sub.classesCanBunk)}</td>
      <td><div class="progress"><div class="progress-bar" style="width:${pct}%;background:${bg}">${pct.toFixed(0)}%</div></div></td>
    </tr>`;
  });

  html += '</tbody></table></div>';
  document.getElementById('academicTable').innerHTML = html;

  createTodayRows();
  setTimeout(() => {
    const tableWrapper = document.querySelector('.table-wrapper');
    const table = tableWrapper?.querySelector('table');
    function updateTable3D() {
      if (!tableWrapper || !table) return;
      const maxScroll = tableWrapper.scrollWidth - tableWrapper.clientWidth;
      const scrollX = tableWrapper.scrollLeft;
      // The 3D "angle" based on scroll position
      const percent = maxScroll ? scrollX / maxScroll : 0;
      const angle = (percent - 0.5) * 12; // -6deg to +6deg 
      table.style.transform = `rotateY(${angle}deg)`;
    }
    if (tableWrapper && table) {
      tableWrapper.addEventListener('scroll', updateTable3D);
      updateTable3D();
    }
  }, 100);


}

function renderBiometric(data) {
  if (!data) {
    document.getElementById('biometricTable').innerHTML = '<div class="empty-state"><div class="empty-state-icon">üì≠</div><p>No biometric data available</p></div>';
    return;
  }

  const pct = Number(data.percentage) || 0;
  // Inject biometric card into stats grid
  const statsGrid = document.getElementById("statsGrid");
  statsGrid.innerHTML += `
    <div class="stat-card">
        <div class="stat-card-header">
          <div>
            <div class="stat-card-title">Biometric %</div>
            <div class="stat-card-value">${pct.toFixed(2)}%</div>
            <div class="stat-card-label">Biometric Attendance</div>
          </div>
  
          <div class="stat-card-icon" style="background: var(--primary-light); display:flex;align-items:center;justify-content:center;">
            <svg xmlns="http://www.w3.org/2000/svg" width="34" height="34" viewBox="0 0 640 640">
              <defs>
                <linearGradient id="fingerprintGradient" x1="0" y1="0" x2="1" y2="1">
                  <stop offset="0%" stop-color="#6366F1"/>   <!-- Indigo -->
                  <stop offset="50%" stop-color="#8B5CF6"/>  <!-- Purple -->
                  <stop offset="100%" stop-color="#EC4899"/> <!-- Pink -->
                </linearGradient>
              </defs>
          
              <path d="M112 320C112 205.1 205.1 112 320 112C383.1 112 439.6 140.1 477.8 184.5C486.4 194.6 501.6 195.7 511.6 187.1C521.6 178.5 522.8 163.3 514.2 153.3C467.3 98.6 397.7 64 320 64C178.6 64 64 178.6 64 320L64 360C64 373.3 74.7 384 88 384C101.3 384 112 373.3 112 360L112 320zM570.5 267.1C567.8 254.1 555 245.8 542.1 248.6C529.2 251.4 520.8 264.1 523.6 277C526.5 290.9 528.1 305.3 528.1 320.1L528.1 360.1C528.1 373.4 538.8 384.1 552.1 384.1C565.4 384.1 576.1 373.4 576.1 360.1L576.1 320.1C576.1 302 574.2 284.3 570.6 267.2zM320 144C301 144 282.6 147 265.5 152.6C250.3 157.6 246.8 176.3 257.2 188.5C264.3 196.8 276 199.3 286.6 196.4C297.2 193.5 308.4 192 320 192C390.7 192 448 249.3 448 320L448 344.9C448 370.1 446.5 395.2 443.6 420.2C441.9 434.8 453 448 467.8 448C479.6 448 489.7 439.4 491.1 427.7C494.4 400.3 496.1 372.7 496.1 345L496.1 320.1C496.1 222.9 417.3 144.1 320.1 144.1zM214.7 212.7C205.6 202.1 189.4 201.3 180.8 212.3C157.7 242.1 144 279.4 144 320L144 344.9C144 369.1 141.4 393.3 136.2 416.8C132.8 432.4 144.1 447.9 160.1 447.9C170.6 447.9 180 440.9 182.3 430.6C188.7 402.5 192 373.8 192 344.8L192 319.9C192 292.7 200.5 267.5 214.9 246.8C222.1 236.4 222.9 222.2 214.7 212.6zM320 224C267 224 224 267 224 320L224 344.9C224 380.8 219.4 416.4 210.2 451C206.4 465.3 216.9 480 231.7 480C241.2 480 249.6 473.8 252.1 464.6C262.6 425.6 268 385.4 268 344.9L268 320C268 291.3 291.3 268 320 268C348.7 268 372 291.3 372 320L372 344.9C372 381.2 368.5 417.3 361.6 452.8C358.9 466.7 369.3 480 383.4 480C393.6 480 402.4 473 404.4 463C412.1 424.2 416 384.7 416 344.9L416 320C416 267 373 224 320 224zM344 320C344 306.7 333.3 296 320 296C306.7 296 296 306.7 296 320L296 344.9C296 404.8 285 464.2 263.5 520.1L257.6 535.4C252.8 547.8 259 561.7 271.4 566.4C283.8 571.1 297.7 565 302.4 552.6L308.3 537.3C331.9 475.9 344 410.7 344 344.9L344 320z" 
                    fill="url(#fingerprintGradient)"/>
            </svg>
          </div>
        </div>
    </div>
  `;
  

  const totalDays = Number(data.totalDays) || 0;
  const presentCount = Number(data.presentCount) || 0;

  let attendCount = 0;
  let bunkCount = 0;

  document.getElementById('biometricAttendBtn').addEventListener('click', () => {
    attendCount++;
    bunkCount = 0;
    // Calculate new attendance percentage incorporating additional attended days
    let newAttendance = ((presentCount + attendCount) / (totalDays+attendCount)) * 100;
    newAttendance = newAttendance.toFixed(2);
  
    document.getElementById('attendanceMessage').textContent = 
      `If you attend ${attendCount} days, your attendance will be ${newAttendance}%`;
  });

  document.getElementById('biometricBunkBtn').addEventListener('click',() => {
    bunkCount++;
    attendCount = 0;
    let newAttendance = ((presentCount) / (totalDays + bunkCount))*100;
    newAttendance = newAttendance.toFixed(2);
    document.getElementById('attendanceMessage').textContent = 
      `If you bunk ${bunkCount} days, your attendance will be ${newAttendance}%`;
  });


  const target = 0.75;
  const daysToAttend = Math.max(0, Math.ceil(((target * totalDays) - presentCount) / (1 - target)));
  const leavesCanTake = Math.max(0, Math.floor((presentCount - (target * totalDays)) / target));

  const bg = pct >= 75 ? 'var(--gradient-success)' : 'var(--gradient-danger)';

  document.getElementById('biometricTable').innerHTML = `
    <div style="display: grid; gap: 16px;">
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px;">
        <div style="background: var(--bg-primary); padding: 16px; border-radius: var(--radius); text-align: center;">
          <div style="font-size: 24px; font-weight: 700; color: ${pct >= 75 ? 'var(--success)' : 'var(--danger)'};">${pct.toFixed(2)}%</div>
          <div style="font-size: 13px; color: var(--text-secondary); margin-top: 4px;">Attendance %</div>
        </div>
        <div style="background: var(--bg-primary); padding: 16px; border-radius: var(--radius); text-align: center;">
          <div style="font-size: 24px; font-weight: 700; color: var(--text-primary);">${totalDays}</div>
          <div style="font-size: 13px; color: var(--text-secondary); margin-top: 4px;">Total Days</div>
        </div>
        <div style="background: var(--bg-primary); padding: 16px; border-radius: var(--radius); text-align: center;">
          <div style="font-size: 24px; font-weight: 700; color: var(--success);">${presentCount}</div>
          <div style="font-size: 13px; color: var(--text-secondary); margin-top: 4px;">Present Days</div>
        </div>
        <div style="background: var(--bg-primary); padding: 16px; border-radius: var(--radius); text-align: center;">
          <div style="font-size: 24px; font-weight: 700; color: var(--primary);">${daysToAttend}</div>
          <div style="font-size: 13px; color: var(--text-secondary); margin-top: 4px;">To Reach 75%</div>
        </div>
        <div style="background: var(--bg-primary); padding: 16px; border-radius: var(--radius); text-align: center;">
          <div style="font-size: 24px; font-weight: 700; color: var(--warning);">${leavesCanTake}</div>
          <div style="font-size: 13px; color: var(--text-secondary); margin-top: 4px;">Can Bunk</div>
        </div>
      </div>
      <div>
        <div class="progress">
          <div class="progress-bar" style="width:${pct}%;background:${bg}">${pct.toFixed(0)}%</div>
        </div>
      </div>
    </div>
  `;
}

function renderLatestAttendance(periods) {
  const statsGrid = document.getElementById("statsGrid");

  for (let p = 1; p <= 6; p++) {
    const info = periods[p];

    const color =
      info.status === "PRESENT"
        ? "var(--success)"
        : info.status === "ABSENT"
        ? "var(--danger)"
        : "var(--warning)";

    const bg =
      info.status === "PRESENT"
        ? "var(--success-light)"
        : info.status === "ABSENT"
        ? "var(--danger-light)"
        : "var(--warning-light)";

    statsGrid.innerHTML += `
      <div class="stat-card">
        <div class="stat-card-header">
          <div>
            <div class="stat-card-title">Period ${p}</div>
            <div class="stat-card-value" style="color:${color};">
              ${info.status}
            </div>
            <div class="stat-card-label">
              <strong>${info.subject}</strong><br>
              <small>${info.date}</small>
            </div>
          </div>
          <div class="stat-card-icon" style="background:${bg}; color:${color};">üìò</div>
        </div>
      </div>
    `;
  }
}



function createTodayRows() {
  todayContainer.innerHTML = '';

  const subjectEls = document.querySelectorAll('#academicTable table tbody tr td:nth-child(2)');
  const subjects = Array.from(subjectEls).map(el => el.textContent.trim()).filter(Boolean);
  if (subjects.length === 0) return;

  for (let i = 0; i < 6; i++) {
    const row = document.createElement('div');
    row.className = 'today-row';

    const select = document.createElement('select');
    subjects.forEach(s => {
      const o = document.createElement('option');
      o.value = s;
      o.text = s;
      select.add(o);
    });
    select.onchange = calculateNewOverall;

    const attendBtn = document.createElement('button');
    attendBtn.textContent = 'Attend';
    attendBtn.dataset.status = '';
    attendBtn.className = 'btn attend-btn';
    attendBtn.onclick = () => {
      attendBtn.dataset.status = 'attend';
      bunkBtn.dataset.status = '';
      attendBtn.classList.add('active');
      bunkBtn.classList.remove('active');
      calculateNewOverall();
    };

    const bunkBtn = document.createElement('button');
    bunkBtn.textContent = 'Bunk';
    bunkBtn.dataset.status = '';
    bunkBtn.className = 'btn bunk-btn';
    bunkBtn.onclick = () => {
      bunkBtn.dataset.status = 'bunk';
      attendBtn.dataset.status = '';
      bunkBtn.classList.add('active');
      attendBtn.classList.remove('active');
      calculateNewOverall();
    };

    const btnContainer = document.createElement('div');
    btnContainer.className = 'btn-container';
    btnContainer.appendChild(attendBtn);
    btnContainer.appendChild(bunkBtn);

    row.appendChild(select);
    row.appendChild(btnContainer);
    todayContainer.appendChild(row);
  }

  newOverallEl.textContent = 'Select attend or bunk for each class to see predicted attendance';
}

resetBtn.addEventListener('click', () => {
  const rows = todayContainer.querySelectorAll('.today-row');
  rows.forEach(row => {
    const attendBtn = row.querySelector('.attend-btn');
    const bunkBtn = row.querySelector('.bunk-btn');
    const select = row.querySelector('select');

    attendBtn.dataset.status = '';
    bunkBtn.dataset.status = '';
    attendBtn.classList.remove('active');
    bunkBtn.classList.remove('active');

    if (select.options.length > 0) select.selectedIndex = 0;
  });

  newOverallEl.textContent = 'Select attend or bunk for each class to see predicted attendance';
});

function calculateNewOverall() {
  const rows = todayContainer.querySelectorAll('.today-row');
  if (rows.length === 0) return;

  const subjectMap = {};
  const trEls = document.querySelectorAll('#academicTable table tbody tr');

  trEls.forEach(tr => {
    const tds = tr.querySelectorAll('td');
    const sub = tds[1].textContent.trim();
    subjectMap[sub] = {
      attended: Number(tds[2].textContent),
      total: Number(tds[3].textContent)
    };
  });

  // Apply simulation selections
  rows.forEach(row => {
    const attendBtn = row.querySelector('.attend-btn');
    const bunkBtn = row.querySelector('.bunk-btn');
    const select = row.querySelector('select');
    const sub = select.value;

    if (!subjectMap[sub]) return;

    if (attendBtn.dataset.status === 'attend') {
      subjectMap[sub].attended += 1;
      subjectMap[sub].total += 1;
    } else if (bunkBtn.dataset.status === 'bunk') {
      subjectMap[sub].total += 1;
    }
  });

  // ----------------------------------------
  // 1Ô∏è‚É£ SUBJECT-WISE AVERAGE (old method)
  // ----------------------------------------
  let sumPct = 0;
  let count = 0;

  for (const sub in subjectMap) {
    const s = subjectMap[sub];
    const pct = s.total ? (s.attended / s.total) * 100 : 0;
    sumPct += pct;
    count++;
  }

  const subjectAvg = (sumPct / count).toFixed(2);
  const subColor = subjectAvg >= 75 ? 'var(--success)' : 'var(--danger)';
  const subBg = subjectAvg >= 75 ? 'var(--gradient-success)' : 'var(--gradient-danger)';

  // ----------------------------------------
  // 2Ô∏è‚É£ TOTAL PRESENT / TOTAL CLASSES (correct)
  // ----------------------------------------
  let totalPresent = 0;
  let totalClasses = 0;

  for (const sub in subjectMap) {
    const s = subjectMap[sub];
    totalPresent += s.attended;
    totalClasses += s.total;
  }

  const overallAvg = totalClasses ? ((totalPresent / totalClasses) * 100).toFixed(2) : 0;
  const overColor = overallAvg >= 75 ? 'var(--success)' : 'var(--danger)';
  const overBg = overallAvg >= 75 ? 'var(--gradient-success)' : 'var(--gradient-danger)';

  // ----------------------------------------
  // UI OUTPUT ‚Üí SHOW BOTH BARS
  // ----------------------------------------
  newOverallEl.innerHTML = `
    <div style="margin-bottom:12px;">
      <b>Subject-wise Average:</b> ${subjectAvg}%<br>
      <div class="progress" style="margin-top:6px;">
        <div class="progress-bar" style="width:${subjectAvg}%; background:${subBg}; color:white;">
          ${subjectAvg}%
        </div>
      </div>
    </div>

    <div>
      <b>Total Present / Total Classes:</b> ${overallAvg}%<br>
      <div class="progress" style="margin-top:6px;">
        <div class="progress-bar" style="width:${overallAvg}%; background:${overBg}; color:white;">
          ${overallAvg}%
        </div>
      </div>
    </div>
  `;

  // Style card
  newOverallEl.style.background = overallAvg >= 75 ? 'var(--success-light)' : 'var(--danger-light)';
  newOverallEl.style.color = overColor;
  newOverallEl.style.borderColor = overColor;
}


function escapeHtml(v) {
  if (v === undefined || v === null) return '';
  return String(v)
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#039;');
}
</script>
</body>
</html>
